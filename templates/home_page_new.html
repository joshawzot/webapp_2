{% extends "base.html" %}

{% block title %}Select Database{% endblock %}

{% block content %}
<div class="container">
    <div class="row">
        <div class="col-md-8">
            <h3>Select Databases:</h3>
            <div class="border p-3 mb-4">
                <div class="form-group">
                    <label for="search-database-name">Search Database:</label>
                    <input type="text" class="form-control" id="search-database-name" placeholder="Search database name..." oninput="filterDatabasesByName()">
                </div>
                <div class="mb-3">
                    <button class="btn btn-primary" id="selectAll">Select All</button>
                    <button class="btn btn-secondary" id="deselectAll">Deselect All</button>
                    <button class="btn btn-info" id="chooseSelected">Choose Selected</button>
                </div>
                <ul id="database-list" class="list-group no-bullets">
                    {% for db in databases %}
                    <li data-database-name="{{ db }}" class="database-item">
                        <input type="checkbox" id="select-database-{{ loop.index }}" class="database-checkbox" data-database-name="{{ db }}">
                        <label for="select-database-{{ loop.index }}" class="ml-2">{{ db }}</label>
                    </li>
                    {% endfor %}
                </ul>
            </div>
        </div>
        <div class="col-md-4">
            <h3>Create New Database:</h3>
            <div class="border p-3 mb-4">
                <form action="/create-database" method="post" class="mb-3">
                    <div class="form-group">
                        <label for="userName">User Name:</label>
                        <input type="text" name="userName" id="userName" class="form-control" placeholder="Enter your name">
                    </div>
                    <div class="form-group">
                        <label for="newDatabaseName">New Database Name:</label>
                        <input type="text" name="newDatabaseName" id="newDatabaseName" class="form-control" placeholder="Enter new database name">
                    </div>
                    <button type="submit" class="btn btn-primary">Create Database</button>
                </form>
            </div>
        </div>
    </div>
</div>

<script>
document.getElementById('selectAll').addEventListener('click', function() {
    document.querySelectorAll('#database-list .database-checkbox').forEach(checkbox => checkbox.checked = true);
});

document.getElementById('deselectAll').addEventListener('click', function() {
    document.querySelectorAll('#database-list .database-checkbox').forEach(checkbox => checkbox.checked = false);
});

document.getElementById('chooseSelected').addEventListener('click', function() {
    const selectedDatabases = Array.from(document.querySelectorAll('#database-list .database-checkbox:checked'))
                                  .map(checkbox => checkbox.getAttribute('data-database-name'));
    if (selectedDatabases.length === 0) {
        alert('Please select at least one database.');
    } else {
        // Redirect to a new page to display tables from the selected databases
        const queryParams = new URLSearchParams({databases: selectedDatabases.join(',')});
        window.location.href = '/list-tables?' + queryParams;
    }
});

function filterDatabasesByName() {
    var input = document.getElementById('search-database-name');
    var filter = input.value.toUpperCase();
    var ul = document.getElementById("database-list");
    var li = ul.getElementsByTagName('li');
    for (var i = 0; i < li.length; i++) {
        var txtValue = li[i].getAttribute('data-database-name');
        if (txtValue.toUpperCase().indexOf(filter) > -1) {
            li[i].style.display = "";
        } else {
            li[i].style.display = "none";
        }
    }
}
</script>

<style>
.no-bullets {
    list-style-type: none;
    padding: 0;
}
</style>

{% endblock %}
